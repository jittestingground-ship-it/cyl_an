<!DOCTYPE html>
<html>
<head>
    <title>Order Details</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/report.css') }}">
</head>
<body>
    <h1 style="text-align:center; color:#000042; margin-top:8px; font-size:2.2em; font-weight:bold;">Order ID: {{ order[1] }}</h1>
    <div class="container">
        <div class="tables">
            <div class="tables-wrapper">
                <div class="table-title"></div>
                <ul class="order-list">
                    <li>
                        <span class="list-label">ORDER ID</span>
                        <span class="list-value">{{ order[1] }}</span>
                    </li>
                    <li>
                        <span class="list-label">CUSTOMER</span>
                        <span class="list-value">{{ order[2] }}</span>
                </ul>
                <div class="table-title1">Test Data</div>
                <ul class="test-list">
                    {% if meta.get('message') %}
                    <li><span class="list-label">{{ meta['message'] }}</span></li>
                    <li><span class="list-label">Scan barcode to run test</span></li>
                    {% else %}
                    <li>
                        <span class="list-label">Pass Fail:</span>
                        <span class="list-value">{{ meta['test_pass_fail'] }}</span>
                    </li>
                    <li>
                        <span class="list-label">AVG (psi) A:</span>
                        <span class="list-value">{{ '%.2f' % meta['avg_pressure_a'] if meta['avg_pressure_a'] is not none else '' }}</span>
                    </li>
                    <li>
                        <span class="list-label">AVG (psi) B:</span>
                        <span class="list-value">{{ '%.2f' % meta['avg_pressure_b'] if meta['avg_pressure_b'] is not none else '' }}</span>
                    </li>
                    <li>
                        <span class="list-label">Set Pressure:</span>
                        <span class="list-value">{{ '%.2f' % meta['set_pressure'] if meta['set_pressure'] is not none else '' }}</span>
                    </li>
                    <li>
                        <span class="list-label">Max Leak PSI:</span>
                        <span class="list-value">{{ '%.2f' % meta['max_leak_pressure'] if meta['max_leak_pressure'] is not none else '' }}</span>
                    </li>
                    {# Removed Saved At row #}
                    {% endif %}
                </ul>
            </div>
        </div>
        <div class="chart">
            <div class="chart-wrapper">
                {% if chart_data["timestamp"] %}
                <div id="pressure_chart"></div>
                <script>
                    var traceA = {
                        x: JSON.parse('{{ chart_data["timestamp"] | tojson | safe }}'),
                        y: JSON.parse('{{ chart_data["pressure_a"] | tojson | safe }}'),
                        mode: 'lines',
                        name: 'Pressure A',
                        line: {color: '#9E2328', width: 4}
                    };
                    var traceB = {
                        x: JSON.parse('{{ chart_data["timestamp"] | tojson | safe }}'),
                        y: JSON.parse('{{ chart_data["pressure_b"] | tojson | safe }}'),
                        mode: 'lines',
                        name: 'Pressure B',
                        line: {color: '#000042', width: 4}
                    };
                    var layout = {
                        title: {
                            margin: { l: 20, r: 10, t: 24, b: 24 },
                            text: 'Pressure vs Time',
                            x: 0.5,
                            y: 0.99,
                            font: {
                                size: 28,
                                color: '#000042',
                                family: 'Arial',
                                weight: 'bold'
                            }
                        },
                        xaxis: {
                            title: {text: 'Time (s)', standoff: 40, font: {color: '#000042', size: 20,family: 'Arial', weight: 'bold'}},
                            range: [0, 70], dtick: 5, gridcolor: 'white',
                            tickfont: {color: '#000042', size: 14, family: 'Arial'},
                            ticks: 'outside',
                            showline: true,
                            linewidth: 2,
                            linecolor: '#000042'
                        },
                        yaxis: {
                            title: {text: 'Pressure (psi)', standoff: 40, font: {color: '#000042', size: 20, family: 'Arial', weight: 'bold'}},
                            range: [0, 120], dtick: 10, gridcolor: 'white',
                            tickfont: {color: '#000042', size: 14, family: 'Arial'},
                            ticks: 'outside',
                            showline: true,
                            linewidth: 2,
                            linecolor: '#000042'
                        },
                        margin: { l: 60, r: 10, t: 60, b: 40 },
                        plot_bgcolor: '#e5e5e5',
                        legend: {
                            bgcolor: 'rgba(0, 0, 0, 0)',
                            orientation: 'v',
                            x: .15,
                            y: -0.35,
                            xanchor: 'left',
                            yanchor: 'bottom',
                            font: {
                                size: 10
                            }
                        },
                        width: undefined
                    };
                    Plotly.newPlot('pressure_chart', [traceA, traceB], layout, {responsive: true});
                </script>
                {% else %}
                <div style="text-align: center; padding: 24px; color: #000042; font-size: 18px;">
                    <h3>No Test Data Available</h3>
                    <p>Use barcode scanner to run test for this order</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>